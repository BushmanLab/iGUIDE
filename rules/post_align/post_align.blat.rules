# -*- mode: Snakemake -*-
# Post-Alignment Processing: BLAT

rule post_align:
  input:
    sampleR1="{sample}.R1.psl.gz",
    sampleR2="{sample}.R2.psl.gz",
    keyR1="{sample}.R1.key.csv",
    keyR2="{sample}.R2.key.csv"
  output:
    uniq="{sample}.uniq.csv",
    chimera="{sample}.chimera.rds",
    multihit="{sample}.multihits.rds"
  shell:
    """
    TOOL="{ROOT_DIR}/tools/blatCoupleR/blatCouple.R"
    Rscript ${{TOOL}} {RUN_DIR}/process/aligned/{input.sampleR2} \
      {RUN_DIR}/process/aligned/{input.sampleR1} \
      -k {RUN_DIR}/process/consolidated/{input.keyR2} \
      {RUN_DIR}/process/consolidated/{input.keyR1} \
      -o {RUN_DIR}/process/processedData/uniqSites/{output.uniq} \
      --chimera {RUN_DIR}/process/processedData/chimeras/{output.chimera} \
      --multihit {RUN_DIR}/process/processedData/multihits/{output.multihit}
    """

