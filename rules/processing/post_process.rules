# -*- mode: Snakemake -*-
# Post-Alignment Processing: BLAT

rule all_uniq_sites:
  input:
    expand(RUN_DIR + "/output/uniqSites/{sample}.uniq.csv", sample=SAMPLES)
  output:
    RUN_DIR + "/output/unique_sites." + RUN + ".csv"
  shell:
    """
    PROC_DIR="{RUN_DIR}/output"
    head -n 1 -q ${{PROC_DIR}}/uniqSites/* | uniq > {output}
    cat ${{PROC_DIR}}/uniqSites/* | sed '/seqnames/d' >> {output}
    """

rule all_edit_sites:
  input:
    RUN_DIR + "/output/unique_sites." + RUN + ".csv"
  output:
    RUN_DIR + "/output/edited_sites." + RUN + ".rds"
  params:
    configfile
    #"./configs/" + RUN + ".config.yml"
  log:
    RUN_DIR + "/logs/{sample}.postproc.log"
  shell:
    """
    TOOL="{ROOT_DIR}/tools/postProcessing/dev_postProcess.R"
    Rscript ${{TOOL}} {input} -o {output} -c {params} > {log} 2>&1
    """

