# -*- mode: Snakemake -*-
# Post-Alignment Processing: BLAT

rule all_uniq_sites:
  input:
    expand("process/processedData/uniqSites/{sample}.uniq.csv", sample=SAMPLES)
  output:
    "process/processedData/unique_sites.{RUN}.csv"
  params:
    RUN_DIR
  shell:
    """
    PROC_DIR="${RUN_DIR}/process/processedData"
    cat ${PROC_DIR}/uniqSites/* | sed '/seqnames/d' > ${PROC_DIR}/alluniqsites.csv
    ls ${PROC_DIR}/uniqSites | head -n 1 | xargs head -n 1 > ${PROC_DIR}/header.csv
    cat ${PROC_DIR}/header.csv ${PROC_DIR}/alluniqsites.csv > {output}
    rm ${PROC_DIR}/header.csv $PROC_DIR/alluniqsites.csv
    """

rule all_edit_sites:
  input:
    "process/processedData/unique_sites.{RUN}.csv"
  output:
    "process/processedData/edited_sites.{RUN}.rds"
  params:
    ROOT_DIR=config["install_directory"]
  shell:
    """
    TOOL="{params.ROOT_DIR}/tools/postProcessing/postProcess.R"
    Rscript ${TOOL}
    """

