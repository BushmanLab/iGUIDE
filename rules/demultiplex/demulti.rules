# -*- mode: Snakemake -*-
# Demultiplexing Rules

rule demultiplex:
  input:
    sampleInfo=config["Sample_Info"],
    R1=config["R1"],
    R2=config["R2"],
    I1=config["I1"],
    I2=config["I2"]
  output:
    expand("demultiplexed/{sample}.{type}.fastq.gz", sample=SAMPLES, type=TYPES)
  params:
    ROOT_DIR,
    RUN_DIR
  threads: config["DemultiThreads"]
  shell:
    """
    TOOL="{params.ROOT_DIR}/tools/dualDemultiplexR/dualDemultiplex.R"
    DATA_DIR="{params.RUN_DIR}/input_data"
    Rscript ${TOOL} {params.RUN_DIR}/input_data/{sampleInfo} \
      --read1 ${DATA_DIR}/{R1} --read2 ${DATA_DIR}/{R2} \
      --index1 ${DATA_DIR}/{I1} --index2 ${DATA_DIR}/{I2} \
      -o {params.RUN_DIR}/process/demultiplexed \
      -c {threads}
    """

