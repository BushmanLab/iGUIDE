# -*- mode: Snakemake -*-
# Look into turning the metadata into a dictionary
# Sequence Trimming Rules

rule seq_trim:
  input:
    seq=RUN_DIR + "/process/demultiplexed/{sample}.{read}.fastq.gz"
  output:
    RUN_DIR + "/process/trimmed/{sample}.{read}.trim.fastq.gz"
  params:
    R1lead=lambda wildcards: R1leadTrim[wildcards.sample],
    R1over=lambda wildcards: R1overTrim[wildcards.sample],
    R2lead=lambda wildcards: R2leadTrim[wildcards.sample],
    R2over=lambda wildcards: R2overTrim[wildcards.sample]
  shell:
    """
    TOOL="{ROOT_DIR}/tools/seqTrimR/seqTrim.R"
    READ=$(echo {input} | cut -d '.' -f 2)
    if [ ${{READ}} = "R1" ]
      Rscript ${{TOOL}} {input.seq} -o {output} \
        -l {params.R1lead} -r {params.R1over} --compress
    else
      Rscript ${{TOOL}} {input.seq} -o {output} \
        -l {params.R2lead} -r {params.R2over} --compress
    fi
    """

